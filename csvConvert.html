<html>
  <head>

  </head>
  <body>
    <script>
      // variable store user`s input file object
      var NicadReport;
      var GcadReport;
      // variable to store path information
      var pathCollection = [[]];
      var codeFileCollection = {};
      // find common substring to find path
      function findCommonSubstring(s1, s2){
        for(var i=0;i<Math.min(s1.length,s2.length);i++){
          if(s1[i] !== s2[i]){
            return s1.subString(0,i-1);
          }
        }
      }
      // initialize file object with check file type of file user uploaded
      function initializeFile(){
        Nicad = document.getElementById("NicadFile").files[0];
        Gcad = document.getElementById("GcadFile").files[0];
        // check uploaded file type
        if(Nicad.type !== "text/html" || Gcad.type !== "text/plain"){
          alert("illegal File type");
          return false;
        }
        else{
          NicadReport = Nicad;
          GcadReport = Gcad;
          return true;
        }
      }
      // initialize file and load content to dom
      function ReadFile(){
        // if load file fail, quit
        if(!initializeFile()){
          return;
        }
        // read NicadReport
        // FileReader usage example: https://stackoverflow.com/questions/12371970/read-text-file-using-filereader
        var reader = new FileReader();
        reader.onload = function(event)
        {
            var contents = event.target.result;
            var lines = contents.split('\n');
            // add content to div for future dom usage
            document.getElementById("readResult").innerHTML=contents;
            // select paths for build path tree
            var tds = document.getElementsByTagName("td");
            // console.log(tds)
            for(var i=0;i<tds.length;i++){
              // path information
              var pathLine = tds[i].childNodes[0].data;
              // 25 is counted from pathLine.split() result
              var path = pathLine.split(" ")[25].split("/");
              path.forEach(function(p,i){
                if(pathCollection[i] === undefined){
                  pathCollection.push([]);
                }
                if(pathCollection[i].indexOf(p) == -1){
                  pathCollection[i].push(p);
                }
              })
              // code information
              var code = tds[i].childNodes[1].innerText;
              if(codeFileCollection[pathLine.split(" ")[25]] === undefined){
                codeFileCollection[pathLine.split(" ")[25]] = [];
              }
              // get class information by dom operation
              var cloneclass = tds[i].parentNode.parentNode.parentNode.previousElementSibling.innerText.split(" ")[2];
              // remove last comma
              var cloneClassNumber = cloneclass.substring(0,cloneclass.length-1);
              codeFileCollection[pathLine.split(" ")[25]].push([cloneClassNumber,code]);
            }
        };
        reader.readAsText(NicadReport);
        // console.log(pathCollection);
        // console.log(codeFileCollection)
      }
    </script>
    <div>
      <label>Submit Nicad Clone Report</label><input id="NicadFile" name="cloneReport" type="file" accept=".html">
      <label>Submit Gcad Report</label><input id="GcadFile" name="cloneReport" type="file" accept=".txt">
      <button onclick="ReadFile()">Submit</button> 
    </div>
    <div id="readResult"></div>
    <div id="pathResult"></div>
  </body>
</html>